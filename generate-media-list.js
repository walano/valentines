/**
 * Run this script whenever you add/remove files in the media folder.
 * It scans media/ and generates mediaData.js so the site can render the gallery.
 *
 * Usage: node generate-media-list.js
 */

const fs = require('fs');
const path = require('path');

const MEDIA_DIR = path.join(__dirname, 'media');
const OUTPUT_FILE = path.join(__dirname, 'mediaData.js');

const IMAGE_EXT = ['.jpg', '.jpeg', '.png', '.gif', '.webp', '.svg'];
const VIDEO_EXT = ['.mp4', '.webm', '.mov', '.ogg'];

function getMediaFiles() {
  if (!fs.existsSync(MEDIA_DIR)) {
    fs.mkdirSync(MEDIA_DIR, { recursive: true });
    return [];
  }

  const files = fs.readdirSync(MEDIA_DIR);
  const media = files
    .filter((file) => {
      const ext = path.extname(file).toLowerCase();
      return IMAGE_EXT.includes(ext) || VIDEO_EXT.includes(ext);
    })
    .sort()
    .map((file) => {
      const ext = path.extname(file).toLowerCase();
      const type = VIDEO_EXT.includes(ext) ? 'video' : 'image';
      return {
        url: `media/${file}`,
        type,
      };
    });

  return media;
}

const mediaData = getMediaFiles();

const content = `/**
 * Auto-generated by generate-media-list.js â€” do not edit by hand.
 * Add files to the media/ folder, then run: node generate-media-list.js
 */

window.mediaData = ${JSON.stringify(mediaData, null, 2)};
`;

fs.writeFileSync(OUTPUT_FILE, content, 'utf8');
console.log(`mediaData.js updated: ${mediaData.length} file(s) from media/`);
if (mediaData.length === 0) {
  console.log('  Add images/videos to the media/ folder and run this script again.');
}
